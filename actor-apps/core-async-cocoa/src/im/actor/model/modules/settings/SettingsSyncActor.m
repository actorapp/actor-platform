//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-platform/actor-apps/core/src/main/java/im/actor/model/modules/settings/SettingsSyncActor.java
//


#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "im/actor/model/api/Parameter.h"
#include "im/actor/model/api/base/SeqUpdate.h"
#include "im/actor/model/api/rpc/RequestEditParameter.h"
#include "im/actor/model/api/rpc/RequestGetParameters.h"
#include "im/actor/model/api/rpc/ResponseGetParameters.h"
#include "im/actor/model/api/rpc/ResponseSeq.h"
#include "im/actor/model/api/updates/UpdateParameterChanged.h"
#include "im/actor/model/droidkit/actors/Actor.h"
#include "im/actor/model/droidkit/engine/PreferencesStorage.h"
#include "im/actor/model/modules/Modules.h"
#include "im/actor/model/modules/Updates.h"
#include "im/actor/model/modules/settings/SettingsSyncActor.h"
#include "im/actor/model/modules/settings/entity/SettingsSyncAction.h"
#include "im/actor/model/modules/settings/entity/SettingsSyncState.h"
#include "im/actor/model/modules/utils/ModuleActor.h"
#include "im/actor/model/network/RpcCallback.h"
#include "im/actor/model/network/RpcException.h"
#include "java/io/IOException.h"
#include "java/util/List.h"

@interface ImActorModelModulesSettingsSettingsSyncActor () {
 @public
  ImActorModelModulesSettingsEntitySettingsSyncState *syncState_;
}

- (void)performSyncWithImActorModelModulesSettingsEntitySettingsSyncAction:(ImActorModelModulesSettingsEntitySettingsSyncAction *)action;

- (void)saveState;

@end

J2OBJC_FIELD_SETTER(ImActorModelModulesSettingsSettingsSyncActor, syncState_, ImActorModelModulesSettingsEntitySettingsSyncState *)

static NSString *ImActorModelModulesSettingsSettingsSyncActor_SYNC_STATE_ = @"settings_sync_state";
J2OBJC_STATIC_FIELD_GETTER(ImActorModelModulesSettingsSettingsSyncActor, SYNC_STATE_, NSString *)

static NSString *ImActorModelModulesSettingsSettingsSyncActor_SYNC_STATE_LOADED_ = @"settings_sync_state_loaded";
J2OBJC_STATIC_FIELD_GETTER(ImActorModelModulesSettingsSettingsSyncActor, SYNC_STATE_LOADED_, NSString *)

__attribute__((unused)) static void ImActorModelModulesSettingsSettingsSyncActor_performSyncWithImActorModelModulesSettingsEntitySettingsSyncAction_(ImActorModelModulesSettingsSettingsSyncActor *self, ImActorModelModulesSettingsEntitySettingsSyncAction *action);

__attribute__((unused)) static void ImActorModelModulesSettingsSettingsSyncActor_saveState(ImActorModelModulesSettingsSettingsSyncActor *self);

@interface ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings () {
 @public
  NSString *key_;
  NSString *value_;
}

@end

J2OBJC_FIELD_SETTER(ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings, key_, NSString *)
J2OBJC_FIELD_SETTER(ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings, value_, NSString *)

@interface ImActorModelModulesSettingsSettingsSyncActor_$1 : NSObject < AMRpcCallback > {
 @public
  ImActorModelModulesSettingsSettingsSyncActor *this$0_;
}

- (void)onResult:(APResponseGetParameters *)response;

- (void)onError:(AMRpcException *)e;

- (instancetype)initWithImActorModelModulesSettingsSettingsSyncActor:(ImActorModelModulesSettingsSettingsSyncActor *)outer$;

@end

J2OBJC_EMPTY_STATIC_INIT(ImActorModelModulesSettingsSettingsSyncActor_$1)

J2OBJC_FIELD_SETTER(ImActorModelModulesSettingsSettingsSyncActor_$1, this$0_, ImActorModelModulesSettingsSettingsSyncActor *)

__attribute__((unused)) static void ImActorModelModulesSettingsSettingsSyncActor_$1_initWithImActorModelModulesSettingsSettingsSyncActor_(ImActorModelModulesSettingsSettingsSyncActor_$1 *self, ImActorModelModulesSettingsSettingsSyncActor *outer$);

__attribute__((unused)) static ImActorModelModulesSettingsSettingsSyncActor_$1 *new_ImActorModelModulesSettingsSettingsSyncActor_$1_initWithImActorModelModulesSettingsSettingsSyncActor_(ImActorModelModulesSettingsSettingsSyncActor *outer$) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ImActorModelModulesSettingsSettingsSyncActor_$1)

@interface ImActorModelModulesSettingsSettingsSyncActor_$2 : NSObject < AMRpcCallback > {
 @public
  ImActorModelModulesSettingsSettingsSyncActor *this$0_;
  ImActorModelModulesSettingsEntitySettingsSyncAction *val$action_;
}

- (void)onResult:(APResponseSeq *)response;

- (void)onError:(AMRpcException *)e;

- (instancetype)initWithImActorModelModulesSettingsSettingsSyncActor:(ImActorModelModulesSettingsSettingsSyncActor *)outer$
             withImActorModelModulesSettingsEntitySettingsSyncAction:(ImActorModelModulesSettingsEntitySettingsSyncAction *)capture$0;

@end

J2OBJC_EMPTY_STATIC_INIT(ImActorModelModulesSettingsSettingsSyncActor_$2)

J2OBJC_FIELD_SETTER(ImActorModelModulesSettingsSettingsSyncActor_$2, this$0_, ImActorModelModulesSettingsSettingsSyncActor *)
J2OBJC_FIELD_SETTER(ImActorModelModulesSettingsSettingsSyncActor_$2, val$action_, ImActorModelModulesSettingsEntitySettingsSyncAction *)

__attribute__((unused)) static void ImActorModelModulesSettingsSettingsSyncActor_$2_initWithImActorModelModulesSettingsSettingsSyncActor_withImActorModelModulesSettingsEntitySettingsSyncAction_(ImActorModelModulesSettingsSettingsSyncActor_$2 *self, ImActorModelModulesSettingsSettingsSyncActor *outer$, ImActorModelModulesSettingsEntitySettingsSyncAction *capture$0);

__attribute__((unused)) static ImActorModelModulesSettingsSettingsSyncActor_$2 *new_ImActorModelModulesSettingsSettingsSyncActor_$2_initWithImActorModelModulesSettingsSettingsSyncActor_withImActorModelModulesSettingsEntitySettingsSyncAction_(ImActorModelModulesSettingsSettingsSyncActor *outer$, ImActorModelModulesSettingsEntitySettingsSyncAction *capture$0) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ImActorModelModulesSettingsSettingsSyncActor_$2)

@implementation ImActorModelModulesSettingsSettingsSyncActor

- (instancetype)initWithImActorModelModulesModules:(ImActorModelModulesModules *)modules {
  ImActorModelModulesSettingsSettingsSyncActor_initWithImActorModelModulesModules_(self, modules);
  return self;
}

- (void)preStart {
  [super preStart];
  syncState_ = new_ImActorModelModulesSettingsEntitySettingsSyncState_init();
  IOSByteArray *data = [((id<DKPreferencesStorage>) nil_chk([self preferences])) getBytesWithKey:ImActorModelModulesSettingsSettingsSyncActor_SYNC_STATE_];
  if (data != nil) {
    @try {
      syncState_ = ImActorModelModulesSettingsEntitySettingsSyncState_fromBytesWithByteArray_(data);
    }
    @catch (JavaIoIOException *e) {
      [((JavaIoIOException *) nil_chk(e)) printStackTrace];
    }
  }
  for (ImActorModelModulesSettingsEntitySettingsSyncAction * __strong action in nil_chk([((ImActorModelModulesSettingsEntitySettingsSyncState *) nil_chk(syncState_)) getPendingActions])) {
    ImActorModelModulesSettingsSettingsSyncActor_performSyncWithImActorModelModulesSettingsEntitySettingsSyncAction_(self, action);
  }
  if (![((id<DKPreferencesStorage>) nil_chk([self preferences])) getBoolWithKey:ImActorModelModulesSettingsSettingsSyncActor_SYNC_STATE_LOADED_ withDefault:NO]) {
    [self requestWithAPRequest:new_APRequestGetParameters_init() withAMRpcCallback:new_ImActorModelModulesSettingsSettingsSyncActor_$1_initWithImActorModelModulesSettingsSettingsSyncActor_(self)];
  }
}

- (void)performSyncWithImActorModelModulesSettingsEntitySettingsSyncAction:(ImActorModelModulesSettingsEntitySettingsSyncAction *)action {
  ImActorModelModulesSettingsSettingsSyncActor_performSyncWithImActorModelModulesSettingsEntitySettingsSyncAction_(self, action);
}

- (void)saveState {
  ImActorModelModulesSettingsSettingsSyncActor_saveState(self);
}

- (void)onReceiveWithId:(id)message {
  if ([message isKindOfClass:[ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings class]]) {
    ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings *changeSettings = (ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings *) check_class_cast(message, [ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings class]);
    ImActorModelModulesSettingsEntitySettingsSyncAction *action = new_ImActorModelModulesSettingsEntitySettingsSyncAction_initWithNSString_withNSString_([((ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings *) nil_chk(changeSettings)) getKey], [changeSettings getValue]);
    [((id<JavaUtilList>) nil_chk([((ImActorModelModulesSettingsEntitySettingsSyncState *) nil_chk(syncState_)) getPendingActions])) addWithId:action];
    ImActorModelModulesSettingsSettingsSyncActor_saveState(self);
    ImActorModelModulesSettingsSettingsSyncActor_performSyncWithImActorModelModulesSettingsEntitySettingsSyncAction_(self, action);
  }
  else {
    [self dropWithId:message];
  }
}

@end

void ImActorModelModulesSettingsSettingsSyncActor_initWithImActorModelModulesModules_(ImActorModelModulesSettingsSettingsSyncActor *self, ImActorModelModulesModules *modules) {
  (void) ImActorModelModulesUtilsModuleActor_initWithImActorModelModulesModules_(self, modules);
}

ImActorModelModulesSettingsSettingsSyncActor *new_ImActorModelModulesSettingsSettingsSyncActor_initWithImActorModelModulesModules_(ImActorModelModulesModules *modules) {
  ImActorModelModulesSettingsSettingsSyncActor *self = [ImActorModelModulesSettingsSettingsSyncActor alloc];
  ImActorModelModulesSettingsSettingsSyncActor_initWithImActorModelModulesModules_(self, modules);
  return self;
}

void ImActorModelModulesSettingsSettingsSyncActor_performSyncWithImActorModelModulesSettingsEntitySettingsSyncAction_(ImActorModelModulesSettingsSettingsSyncActor *self, ImActorModelModulesSettingsEntitySettingsSyncAction *action) {
  [self requestWithAPRequest:new_APRequestEditParameter_initWithNSString_withNSString_([((ImActorModelModulesSettingsEntitySettingsSyncAction *) nil_chk(action)) getKey], [action getValue]) withAMRpcCallback:new_ImActorModelModulesSettingsSettingsSyncActor_$2_initWithImActorModelModulesSettingsSettingsSyncActor_withImActorModelModulesSettingsEntitySettingsSyncAction_(self, action)];
}

void ImActorModelModulesSettingsSettingsSyncActor_saveState(ImActorModelModulesSettingsSettingsSyncActor *self) {
  [((id<DKPreferencesStorage>) nil_chk([self preferences])) putBytesWithKey:ImActorModelModulesSettingsSettingsSyncActor_SYNC_STATE_ withValue:[((ImActorModelModulesSettingsEntitySettingsSyncState *) nil_chk(self->syncState_)) toByteArray]];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesSettingsSettingsSyncActor)

@implementation ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings

- (instancetype)initWithNSString:(NSString *)key
                    withNSString:(NSString *)value {
  ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings_initWithNSString_withNSString_(self, key, value);
  return self;
}

- (NSString *)getKey {
  return key_;
}

- (NSString *)getValue {
  return value_;
}

@end

void ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings_initWithNSString_withNSString_(ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings *self, NSString *key, NSString *value) {
  (void) NSObject_init(self);
  self->key_ = key;
  self->value_ = value;
}

ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings *new_ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings_initWithNSString_withNSString_(NSString *key, NSString *value) {
  ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings *self = [ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings alloc];
  ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings_initWithNSString_withNSString_(self, key, value);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesSettingsSettingsSyncActor_ChangeSettings)

@implementation ImActorModelModulesSettingsSettingsSyncActor_$1

- (void)onResult:(APResponseGetParameters *)response {
  for (APParameter * __strong p in nil_chk([((APResponseGetParameters *) nil_chk(response)) getParameters])) {
    [((id<DKPreferencesStorage>) nil_chk([((ImActorModelModulesModules *) nil_chk([this$0_ modules])) getPreferences])) putStringWithKey:[((APParameter *) nil_chk(p)) getKey] withValue:[p getValue]];
  }
  [((id<DKPreferencesStorage>) nil_chk([this$0_ preferences])) putBoolWithKey:ImActorModelModulesSettingsSettingsSyncActor_get_SYNC_STATE_LOADED_() withValue:YES];
}

- (void)onError:(AMRpcException *)e {
}

- (instancetype)initWithImActorModelModulesSettingsSettingsSyncActor:(ImActorModelModulesSettingsSettingsSyncActor *)outer$ {
  ImActorModelModulesSettingsSettingsSyncActor_$1_initWithImActorModelModulesSettingsSettingsSyncActor_(self, outer$);
  return self;
}

@end

void ImActorModelModulesSettingsSettingsSyncActor_$1_initWithImActorModelModulesSettingsSettingsSyncActor_(ImActorModelModulesSettingsSettingsSyncActor_$1 *self, ImActorModelModulesSettingsSettingsSyncActor *outer$) {
  self->this$0_ = outer$;
  (void) NSObject_init(self);
}

ImActorModelModulesSettingsSettingsSyncActor_$1 *new_ImActorModelModulesSettingsSettingsSyncActor_$1_initWithImActorModelModulesSettingsSettingsSyncActor_(ImActorModelModulesSettingsSettingsSyncActor *outer$) {
  ImActorModelModulesSettingsSettingsSyncActor_$1 *self = [ImActorModelModulesSettingsSettingsSyncActor_$1 alloc];
  ImActorModelModulesSettingsSettingsSyncActor_$1_initWithImActorModelModulesSettingsSettingsSyncActor_(self, outer$);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesSettingsSettingsSyncActor_$1)

@implementation ImActorModelModulesSettingsSettingsSyncActor_$2

- (void)onResult:(APResponseSeq *)response {
  [((id<JavaUtilList>) nil_chk([((ImActorModelModulesSettingsEntitySettingsSyncState *) nil_chk(this$0_->syncState_)) getPendingActions])) removeWithId:val$action_];
  ImActorModelModulesSettingsSettingsSyncActor_saveState(this$0_);
  [((ImActorModelModulesUpdates *) nil_chk([this$0_ updates])) onUpdateReceivedWithId:new_ImActorModelApiBaseSeqUpdate_initWithInt_withByteArray_withInt_withByteArray_([((APResponseSeq *) nil_chk(response)) getSeq], [response getState], APUpdateParameterChanged_HEADER, [new_APUpdateParameterChanged_initWithNSString_withNSString_([((ImActorModelModulesSettingsEntitySettingsSyncAction *) nil_chk(val$action_)) getKey], [val$action_ getValue]) toByteArray])];
}

- (void)onError:(AMRpcException *)e {
}

- (instancetype)initWithImActorModelModulesSettingsSettingsSyncActor:(ImActorModelModulesSettingsSettingsSyncActor *)outer$
             withImActorModelModulesSettingsEntitySettingsSyncAction:(ImActorModelModulesSettingsEntitySettingsSyncAction *)capture$0 {
  ImActorModelModulesSettingsSettingsSyncActor_$2_initWithImActorModelModulesSettingsSettingsSyncActor_withImActorModelModulesSettingsEntitySettingsSyncAction_(self, outer$, capture$0);
  return self;
}

@end

void ImActorModelModulesSettingsSettingsSyncActor_$2_initWithImActorModelModulesSettingsSettingsSyncActor_withImActorModelModulesSettingsEntitySettingsSyncAction_(ImActorModelModulesSettingsSettingsSyncActor_$2 *self, ImActorModelModulesSettingsSettingsSyncActor *outer$, ImActorModelModulesSettingsEntitySettingsSyncAction *capture$0) {
  self->this$0_ = outer$;
  self->val$action_ = capture$0;
  (void) NSObject_init(self);
}

ImActorModelModulesSettingsSettingsSyncActor_$2 *new_ImActorModelModulesSettingsSettingsSyncActor_$2_initWithImActorModelModulesSettingsSettingsSyncActor_withImActorModelModulesSettingsEntitySettingsSyncAction_(ImActorModelModulesSettingsSettingsSyncActor *outer$, ImActorModelModulesSettingsEntitySettingsSyncAction *capture$0) {
  ImActorModelModulesSettingsSettingsSyncActor_$2 *self = [ImActorModelModulesSettingsSettingsSyncActor_$2 alloc];
  ImActorModelModulesSettingsSettingsSyncActor_$2_initWithImActorModelModulesSettingsSettingsSyncActor_withImActorModelModulesSettingsEntitySettingsSyncAction_(self, outer$, capture$0);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesSettingsSettingsSyncActor_$2)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-platform/actor-apps/library/core/src/main/java/im/actor/model/viewmodel/UserVM.java
//


#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "im/actor/model/MainThreadProvider.h"
#include "im/actor/model/entity/Avatar.h"
#include "im/actor/model/entity/ContactRecord.h"
#include "im/actor/model/entity/ContactRecordType.h"
#include "im/actor/model/entity/Sex.h"
#include "im/actor/model/entity/User.h"
#include "im/actor/model/modules/Contacts.h"
#include "im/actor/model/modules/Modules.h"
#include "im/actor/model/mvvm/BaseValueModel.h"
#include "im/actor/model/mvvm/MVVMEngine.h"
#include "im/actor/model/mvvm/ModelChangedListener.h"
#include "im/actor/model/mvvm/generics/ArrayListUserPhone.h"
#include "im/actor/model/mvvm/generics/AvatarValueModel.h"
#include "im/actor/model/mvvm/generics/BooleanValueModel.h"
#include "im/actor/model/mvvm/generics/StringValueModel.h"
#include "im/actor/model/mvvm/generics/UserPhoneValueModel.h"
#include "im/actor/model/mvvm/generics/UserPresenceValueModel.h"
#include "im/actor/model/viewmodel/UserPhone.h"
#include "im/actor/model/viewmodel/UserPresence.h"
#include "im/actor/model/viewmodel/UserVM.h"
#include "java/lang/Boolean.h"
#include "java/lang/Long.h"
#include "java/lang/Runnable.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"

@interface AMUserVM () {
 @public
  jint id__;
  jboolean isBot__;
  AMStringValueModel *name_;
  AMAvatarValueModel *avatar_;
  AMSexEnum *sex_;
  AMBooleanValueModel *isContact__;
  AMUserPresenceValueModel *presence_;
  AMUserPhoneValueModel *phones_;
  JavaUtilArrayList *listeners_;
}

- (AMArrayListUserPhone *)buildPhonesWithJavaUtilList:(id<JavaUtilList>)records;

- (void)notifyChange;

@end

J2OBJC_FIELD_SETTER(AMUserVM, name_, AMStringValueModel *)
J2OBJC_FIELD_SETTER(AMUserVM, avatar_, AMAvatarValueModel *)
J2OBJC_FIELD_SETTER(AMUserVM, sex_, AMSexEnum *)
J2OBJC_FIELD_SETTER(AMUserVM, isContact__, AMBooleanValueModel *)
J2OBJC_FIELD_SETTER(AMUserVM, presence_, AMUserPresenceValueModel *)
J2OBJC_FIELD_SETTER(AMUserVM, phones_, AMUserPhoneValueModel *)
J2OBJC_FIELD_SETTER(AMUserVM, listeners_, JavaUtilArrayList *)

__attribute__((unused)) static AMArrayListUserPhone *AMUserVM_buildPhonesWithJavaUtilList_(AMUserVM *self, id<JavaUtilList> records);

__attribute__((unused)) static void AMUserVM_notifyChange(AMUserVM *self);

@interface AMUserVM_$1 : NSObject < JavaLangRunnable > {
 @public
  AMUserVM *this$0_;
}

- (void)run;

- (instancetype)initWithAMUserVM:(AMUserVM *)outer$;

@end

J2OBJC_EMPTY_STATIC_INIT(AMUserVM_$1)

J2OBJC_FIELD_SETTER(AMUserVM_$1, this$0_, AMUserVM *)

__attribute__((unused)) static void AMUserVM_$1_initWithAMUserVM_(AMUserVM_$1 *self, AMUserVM *outer$);

__attribute__((unused)) static AMUserVM_$1 *new_AMUserVM_$1_initWithAMUserVM_(AMUserVM *outer$) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(AMUserVM_$1)

@implementation AMUserVM

- (instancetype)initWithAMUser:(AMUser *)user
withImActorModelModulesModules:(ImActorModelModulesModules *)modules {
  AMUserVM_initWithAMUser_withImActorModelModulesModules_(self, user, modules);
  return self;
}

- (void)updateValuesWithId:(AMUser *)rawObj {
  jboolean isChanged = [((AMStringValueModel *) nil_chk(name_)) changeWithValue:[((AMUser *) nil_chk(rawObj)) getName]];
  isChanged |= [((AMAvatarValueModel *) nil_chk(avatar_)) changeWithValue:[rawObj getAvatar]];
  isChanged |= [((AMUserPhoneValueModel *) nil_chk(phones_)) changeWithValue:AMUserVM_buildPhonesWithJavaUtilList_(self, [rawObj getRecords])];
  if (isChanged) {
    AMUserVM_notifyChange(self);
  }
}

- (jint)getId {
  return id__;
}

- (jboolean)isBot {
  return isBot__;
}

- (AMStringValueModel *)getNameModel {
  return name_;
}

- (AMAvatarValueModel *)getAvatarModel {
  return avatar_;
}

- (AMSexEnum *)getSex {
  return sex_;
}

- (AMBooleanValueModel *)isContactModel {
  return isContact__;
}

- (AMUserPresenceValueModel *)getPresenceModel {
  return presence_;
}

- (AMUserPhoneValueModel *)getPhonesModel {
  return phones_;
}

- (AMArrayListUserPhone *)buildPhonesWithJavaUtilList:(id<JavaUtilList>)records {
  return AMUserVM_buildPhonesWithJavaUtilList_(self, records);
}

- (void)subscribeWithListener:(id<AMModelChangedListener>)listener {
  AMMVVMEngine_checkMainThread();
  if ([((JavaUtilArrayList *) nil_chk(listeners_)) containsWithId:listener]) {
    return;
  }
  [listeners_ addWithId:listener];
  [((id<AMModelChangedListener>) nil_chk(listener)) onChanged:self];
}

- (void)unsubscribeWithListener:(id<AMModelChangedListener>)listener {
  AMMVVMEngine_checkMainThread();
  [((JavaUtilArrayList *) nil_chk(listeners_)) removeWithId:listener];
}

- (void)notifyChange {
  AMUserVM_notifyChange(self);
}

@end

void AMUserVM_initWithAMUser_withImActorModelModulesModules_(AMUserVM *self, AMUser *user, ImActorModelModulesModules *modules) {
  (void) AMBaseValueModel_initWithId_(self, user);
  self->listeners_ = new_JavaUtilArrayList_init();
  self->id__ = [((AMUser *) nil_chk(user)) getUid];
  self->sex_ = [user getSex];
  self->isBot__ = [user isBot];
  self->name_ = new_AMStringValueModel_initWithNSString_withNSString_(JreStrcat("$I$", @"user.", self->id__, @".name"), [user getName]);
  self->avatar_ = new_AMAvatarValueModel_initWithNSString_withAMAvatar_(JreStrcat("$I$", @"user.", self->id__, @".avatar"), [user getAvatar]);
  self->isContact__ = new_AMBooleanValueModel_initWithNSString_withJavaLangBoolean_(JreStrcat("$I$", @"user.", self->id__, @".contact"), JavaLangBoolean_valueOfWithBoolean_([((ImActorModelModulesContacts *) nil_chk([((ImActorModelModulesModules *) nil_chk(modules)) getContactsModule])) isUserContactWithInt:self->id__]));
  self->presence_ = new_AMUserPresenceValueModel_initWithNSString_withAMUserPresence_(JreStrcat("$I$", @"user.", self->id__, @".presence"), new_AMUserPresence_initWithAMUserPresence_StateEnum_(AMUserPresence_StateEnum_get_UNKNOWN()));
  self->phones_ = new_AMUserPhoneValueModel_initWithNSString_withAMArrayListUserPhone_(JreStrcat("$I$", @"user.", self->id__, @".phones"), AMUserVM_buildPhonesWithJavaUtilList_(self, [user getRecords]));
}

AMUserVM *new_AMUserVM_initWithAMUser_withImActorModelModulesModules_(AMUser *user, ImActorModelModulesModules *modules) {
  AMUserVM *self = [AMUserVM alloc];
  AMUserVM_initWithAMUser_withImActorModelModulesModules_(self, user, modules);
  return self;
}

AMArrayListUserPhone *AMUserVM_buildPhonesWithJavaUtilList_(AMUserVM *self, id<JavaUtilList> records) {
  AMArrayListUserPhone *res = new_AMArrayListUserPhone_init();
  for (AMContactRecord * __strong r in nil_chk(records)) {
    if ([((AMContactRecord *) nil_chk(r)) getRecordType] == AMContactRecordTypeEnum_get_PHONE()) {
      [res addWithId:new_AMUserPhone_initWithLong_withNSString_(JavaLangLong_parseLongWithNSString_([r getRecordData]), [r getRecordTitle])];
    }
  }
  return res;
}

void AMUserVM_notifyChange(AMUserVM *self) {
  [((id<AMMainThreadProvider>) nil_chk(AMMVVMEngine_getMainThreadProvider())) postToMainThreadWithRunnable:new_AMUserVM_$1_initWithAMUserVM_(self)];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(AMUserVM)

@implementation AMUserVM_$1

- (void)run {
  {
    IOSObjectArray *a__ = [this$0_->listeners_ toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:[((JavaUtilArrayList *) nil_chk(this$0_->listeners_)) size] type:AMModelChangedListener_class_()]];
    id<AMModelChangedListener> const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    id<AMModelChangedListener> const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      id<AMModelChangedListener> l = *b__++;
      [((id<AMModelChangedListener>) nil_chk(l)) onChanged:this$0_];
    }
  }
}

- (instancetype)initWithAMUserVM:(AMUserVM *)outer$ {
  AMUserVM_$1_initWithAMUserVM_(self, outer$);
  return self;
}

@end

void AMUserVM_$1_initWithAMUserVM_(AMUserVM_$1 *self, AMUserVM *outer$) {
  self->this$0_ = outer$;
  (void) NSObject_init(self);
}

AMUserVM_$1 *new_AMUserVM_$1_initWithAMUserVM_(AMUserVM *outer$) {
  AMUserVM_$1 *self = [AMUserVM_$1 alloc];
  AMUserVM_$1_initWithAMUserVM_(self, outer$);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(AMUserVM_$1)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-platform/actor-apps/library/core/src/main/java/im/actor/model/droidkit/actors/ActorSystem.java
//


#include "J2ObjC_source.h"
#include "im/actor/model/droidkit/actors/ActorRef.h"
#include "im/actor/model/droidkit/actors/ActorSelection.h"
#include "im/actor/model/droidkit/actors/ActorSystem.h"
#include "im/actor/model/droidkit/actors/Environment.h"
#include "im/actor/model/droidkit/actors/Props.h"
#include "im/actor/model/droidkit/actors/ThreadPriority.h"
#include "im/actor/model/droidkit/actors/TraceInterface.h"
#include "im/actor/model/droidkit/actors/mailbox/ActorDispatcher.h"
#include "java/lang/RuntimeException.h"
#include "java/util/HashMap.h"

@interface DKActorSystem () {
 @public
  JavaUtilHashMap *dispatchers_;
  id<DKTraceInterface> traceInterface_;
}

@end

J2OBJC_FIELD_SETTER(DKActorSystem, dispatchers_, JavaUtilHashMap *)
J2OBJC_FIELD_SETTER(DKActorSystem, traceInterface_, id<DKTraceInterface>)

static DKActorSystem *DKActorSystem_mainSystem_;
J2OBJC_STATIC_FIELD_GETTER(DKActorSystem, mainSystem_, DKActorSystem *)

static NSString *DKActorSystem_DEFAULT_DISPATCHER_ = @"default";
J2OBJC_STATIC_FIELD_GETTER(DKActorSystem, DEFAULT_DISPATCHER_, NSString *)

J2OBJC_INITIALIZED_DEFN(DKActorSystem)

@implementation DKActorSystem

+ (DKActorSystem *)system {
  return DKActorSystem_system();
}

- (instancetype)init {
  DKActorSystem_init(self);
  return self;
}

- (instancetype)initWithBoolean:(jboolean)addDefaultDispatcher {
  DKActorSystem_initWithBoolean_(self, addDefaultDispatcher);
  return self;
}

- (void)addDispatcherWithNSString:(NSString *)dispatcherId
                          withInt:(jint)threadsCount {
  @synchronized(dispatchers_) {
    if ([((JavaUtilHashMap *) nil_chk(dispatchers_)) containsKeyWithId:dispatcherId]) {
      return;
    }
    DKActorDispatcher *dispatcher = DKEnvironment_createDispatcherWithNSString_withInt_withDKThreadPriorityEnum_withDKActorSystem_(dispatcherId, threadsCount, DKThreadPriorityEnum_get_LOW(), self);
    (void) [dispatchers_ putWithId:dispatcherId withId:dispatcher];
  }
}

- (void)addDispatcherWithNSString:(NSString *)dispatcherId {
  @synchronized(dispatchers_) {
    if ([((JavaUtilHashMap *) nil_chk(dispatchers_)) containsKeyWithId:dispatcherId]) {
      return;
    }
    DKActorDispatcher *dispatcher = DKEnvironment_createDefaultDispatcherWithNSString_withDKThreadPriorityEnum_withDKActorSystem_(dispatcherId, DKThreadPriorityEnum_get_LOW(), self);
    [self addDispatcherWithNSString:dispatcherId withDKActorDispatcher:dispatcher];
  }
}

- (void)addDispatcherWithNSString:(NSString *)dispatcherId
            withDKActorDispatcher:(DKActorDispatcher *)dispatcher {
  @synchronized(dispatchers_) {
    if ([((JavaUtilHashMap *) nil_chk(dispatchers_)) containsKeyWithId:dispatcherId]) {
      return;
    }
    (void) [dispatchers_ putWithId:dispatcherId withId:dispatcher];
  }
}

- (DKActorRef *)actorOfWithDKActorSelection:(DKActorSelection *)selection {
  return [self actorOfWithDKProps:[((DKActorSelection *) nil_chk(selection)) getProps] withNSString:[selection getPath]];
}

- (DKActorRef *)actorOfWithDKProps:(DKProps *)props
                      withNSString:(NSString *)path {
  NSString *dispatcherId = [((DKProps *) nil_chk(props)) getDispatcher] == nil ? DKActorSystem_DEFAULT_DISPATCHER_ : [props getDispatcher];
  DKActorDispatcher *mailboxesDispatcher;
  @synchronized(dispatchers_) {
    if (![((JavaUtilHashMap *) nil_chk(dispatchers_)) containsKeyWithId:dispatcherId]) {
      @throw new_JavaLangRuntimeException_initWithNSString_(JreStrcat("$$C", @"Unknown dispatcherId '", dispatcherId, '\''));
    }
    mailboxesDispatcher = [dispatchers_ getWithId:dispatcherId];
  }
  return [((DKActorDispatcher *) nil_chk(mailboxesDispatcher)) referenceActorWithNSString:path withDKProps:props];
}

- (id<DKTraceInterface>)getTraceInterface {
  return traceInterface_;
}

- (void)setTraceInterfaceWithDKTraceInterface:(id<DKTraceInterface>)traceInterface {
  self->traceInterface_ = traceInterface;
}

+ (void)initialize {
  if (self == [DKActorSystem class]) {
    DKActorSystem_mainSystem_ = new_DKActorSystem_init();
    J2OBJC_SET_INITIALIZED(DKActorSystem)
  }
}

@end

DKActorSystem *DKActorSystem_system() {
  DKActorSystem_initialize();
  return DKActorSystem_mainSystem_;
}

void DKActorSystem_init(DKActorSystem *self) {
  (void) DKActorSystem_initWithBoolean_(self, YES);
}

DKActorSystem *new_DKActorSystem_init() {
  DKActorSystem *self = [DKActorSystem alloc];
  DKActorSystem_init(self);
  return self;
}

void DKActorSystem_initWithBoolean_(DKActorSystem *self, jboolean addDefaultDispatcher) {
  (void) NSObject_init(self);
  self->dispatchers_ = new_JavaUtilHashMap_init();
  if (addDefaultDispatcher) {
    [self addDispatcherWithNSString:DKActorSystem_DEFAULT_DISPATCHER_];
  }
}

DKActorSystem *new_DKActorSystem_initWithBoolean_(jboolean addDefaultDispatcher) {
  DKActorSystem *self = [DKActorSystem alloc];
  DKActorSystem_initWithBoolean_(self, addDefaultDispatcher);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(DKActorSystem)

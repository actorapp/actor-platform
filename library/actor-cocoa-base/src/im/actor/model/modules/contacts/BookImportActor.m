//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-model/library/actor-cocoa-base/build/java/im/actor/model/modules/contacts/BookImportActor.java
//


#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "im/actor/model/Configuration.h"
#include "im/actor/model/PhoneBookProvider.h"
#include "im/actor/model/api/EmailToImport.h"
#include "im/actor/model/api/PhoneToImport.h"
#include "im/actor/model/api/User.h"
#include "im/actor/model/api/base/FatSeqUpdate.h"
#include "im/actor/model/api/rpc/RequestImportContacts.h"
#include "im/actor/model/api/rpc/ResponseImportContacts.h"
#include "im/actor/model/api/updates/UpdateContactsAdded.h"
#include "im/actor/model/droidkit/actors/Actor.h"
#include "im/actor/model/droidkit/actors/ActorRef.h"
#include "im/actor/model/droidkit/engine/PreferencesStorage.h"
#include "im/actor/model/entity/PhoneBookContact.h"
#include "im/actor/model/entity/PhoneBookEmail.h"
#include "im/actor/model/entity/PhoneBookPhone.h"
#include "im/actor/model/log/Log.h"
#include "im/actor/model/modules/AppStateModule.h"
#include "im/actor/model/modules/Modules.h"
#include "im/actor/model/modules/Updates.h"
#include "im/actor/model/modules/contacts/BookImportActor.h"
#include "im/actor/model/modules/utils/ModuleActor.h"
#include "im/actor/model/network/RpcCallback.h"
#include "im/actor/model/network/RpcException.h"
#include "java/lang/Integer.h"
#include "java/lang/Long.h"
#include "java/util/ArrayList.h"
#include "java/util/HashSet.h"
#include "java/util/List.h"

#define ImActorModelModulesContactsBookImportActor_MAX_IMPORT_SIZE 50

@interface ImActorModelModulesContactsBookImportActor () {
 @public
  jboolean ENABLE_LOG_;
  JavaUtilHashSet *importingPhones_;
  JavaUtilHashSet *importingEmails_;
  jboolean isSyncInProgress_;
}

- (void)performSync;

- (void)onPhoneBookLoadedWithJavaUtilList:(id<JavaUtilList>)phoneBook;

- (void)performImportWithJavaUtilArrayList:(JavaUtilArrayList *)phoneToImportsPart
                     withJavaUtilArrayList:(JavaUtilArrayList *)emailToImportsPart;

- (jboolean)isImportedWithLong:(jlong)phone;

- (jboolean)isImportedWithNSString:(NSString *)email;

- (void)markImportedWithLong:(jlong)phone;

- (void)markImportedWithNSString:(NSString *)email;

- (void)markImported;

@end

J2OBJC_FIELD_SETTER(ImActorModelModulesContactsBookImportActor, importingPhones_, JavaUtilHashSet *)
J2OBJC_FIELD_SETTER(ImActorModelModulesContactsBookImportActor, importingEmails_, JavaUtilHashSet *)

static NSString *ImActorModelModulesContactsBookImportActor_TAG_ = @"ContactsImport";
J2OBJC_STATIC_FIELD_GETTER(ImActorModelModulesContactsBookImportActor, TAG_, NSString *)

J2OBJC_STATIC_FIELD_GETTER(ImActorModelModulesContactsBookImportActor, MAX_IMPORT_SIZE, jint)

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_performSync(ImActorModelModulesContactsBookImportActor *self);

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_onPhoneBookLoadedWithJavaUtilList_(ImActorModelModulesContactsBookImportActor *self, id<JavaUtilList> phoneBook);

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_performImportWithJavaUtilArrayList_withJavaUtilArrayList_(ImActorModelModulesContactsBookImportActor *self, JavaUtilArrayList *phoneToImportsPart, JavaUtilArrayList *emailToImportsPart);

__attribute__((unused)) static jboolean ImActorModelModulesContactsBookImportActor_isImportedWithLong_(ImActorModelModulesContactsBookImportActor *self, jlong phone);

__attribute__((unused)) static jboolean ImActorModelModulesContactsBookImportActor_isImportedWithNSString_(ImActorModelModulesContactsBookImportActor *self, NSString *email);

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_markImportedWithLong_(ImActorModelModulesContactsBookImportActor *self, jlong phone);

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_markImportedWithNSString_(ImActorModelModulesContactsBookImportActor *self, NSString *email);

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_markImported(ImActorModelModulesContactsBookImportActor *self);

@interface ImActorModelModulesContactsBookImportActor_PhoneBookLoaded : NSObject {
 @public
  id<JavaUtilList> phoneBook_;
}

- (instancetype)initWithJavaUtilList:(id<JavaUtilList>)phoneBook;

- (id<JavaUtilList>)getPhoneBook;

@end

J2OBJC_EMPTY_STATIC_INIT(ImActorModelModulesContactsBookImportActor_PhoneBookLoaded)

J2OBJC_FIELD_SETTER(ImActorModelModulesContactsBookImportActor_PhoneBookLoaded, phoneBook_, id<JavaUtilList>)

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_PhoneBookLoaded_initWithJavaUtilList_(ImActorModelModulesContactsBookImportActor_PhoneBookLoaded *self, id<JavaUtilList> phoneBook);

__attribute__((unused)) static ImActorModelModulesContactsBookImportActor_PhoneBookLoaded *new_ImActorModelModulesContactsBookImportActor_PhoneBookLoaded_initWithJavaUtilList_(id<JavaUtilList> phoneBook) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ImActorModelModulesContactsBookImportActor_PhoneBookLoaded)

@interface ImActorModelModulesContactsBookImportActor_$1 : NSObject < AMPhoneBookProvider_Callback > {
 @public
  ImActorModelModulesContactsBookImportActor *this$0_;
}

- (void)onLoadedWithContacts:(id<JavaUtilList>)contacts;

- (instancetype)initWithImActorModelModulesContactsBookImportActor:(ImActorModelModulesContactsBookImportActor *)outer$;

@end

J2OBJC_EMPTY_STATIC_INIT(ImActorModelModulesContactsBookImportActor_$1)

J2OBJC_FIELD_SETTER(ImActorModelModulesContactsBookImportActor_$1, this$0_, ImActorModelModulesContactsBookImportActor *)

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_$1_initWithImActorModelModulesContactsBookImportActor_(ImActorModelModulesContactsBookImportActor_$1 *self, ImActorModelModulesContactsBookImportActor *outer$);

__attribute__((unused)) static ImActorModelModulesContactsBookImportActor_$1 *new_ImActorModelModulesContactsBookImportActor_$1_initWithImActorModelModulesContactsBookImportActor_(ImActorModelModulesContactsBookImportActor *outer$) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ImActorModelModulesContactsBookImportActor_$1)

@interface ImActorModelModulesContactsBookImportActor_$2 : NSObject < AMRpcCallback > {
 @public
  ImActorModelModulesContactsBookImportActor *this$0_;
  IOSObjectArray *val$phones_;
  IOSObjectArray *val$emailToImports_;
}

- (void)onResult:(ImActorModelApiRpcResponseImportContacts *)response;

- (void)onError:(AMRpcException *)e;

- (instancetype)initWithImActorModelModulesContactsBookImportActor:(ImActorModelModulesContactsBookImportActor *)outer$
                             withImActorModelApiPhoneToImportArray:(IOSObjectArray *)capture$0
                             withImActorModelApiEmailToImportArray:(IOSObjectArray *)capture$1;

@end

J2OBJC_EMPTY_STATIC_INIT(ImActorModelModulesContactsBookImportActor_$2)

J2OBJC_FIELD_SETTER(ImActorModelModulesContactsBookImportActor_$2, this$0_, ImActorModelModulesContactsBookImportActor *)
J2OBJC_FIELD_SETTER(ImActorModelModulesContactsBookImportActor_$2, val$phones_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(ImActorModelModulesContactsBookImportActor_$2, val$emailToImports_, IOSObjectArray *)

__attribute__((unused)) static void ImActorModelModulesContactsBookImportActor_$2_initWithImActorModelModulesContactsBookImportActor_withImActorModelApiPhoneToImportArray_withImActorModelApiEmailToImportArray_(ImActorModelModulesContactsBookImportActor_$2 *self, ImActorModelModulesContactsBookImportActor *outer$, IOSObjectArray *capture$0, IOSObjectArray *capture$1);

__attribute__((unused)) static ImActorModelModulesContactsBookImportActor_$2 *new_ImActorModelModulesContactsBookImportActor_$2_initWithImActorModelModulesContactsBookImportActor_withImActorModelApiPhoneToImportArray_withImActorModelApiEmailToImportArray_(ImActorModelModulesContactsBookImportActor *outer$, IOSObjectArray *capture$0, IOSObjectArray *capture$1) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ImActorModelModulesContactsBookImportActor_$2)

@implementation ImActorModelModulesContactsBookImportActor

- (instancetype)initWithImActorModelModulesModules:(ImActorModelModulesModules *)messenger {
  ImActorModelModulesContactsBookImportActor_initWithImActorModelModulesModules_(self, messenger);
  return self;
}

- (void)preStart {
  [super preStart];
  [((DKActorRef *) nil_chk([self self__])) sendWithId:new_ImActorModelModulesContactsBookImportActor_PerformSync_init()];
}

- (void)performSync {
  ImActorModelModulesContactsBookImportActor_performSync(self);
}

- (void)onPhoneBookLoadedWithJavaUtilList:(id<JavaUtilList>)phoneBook {
  ImActorModelModulesContactsBookImportActor_onPhoneBookLoadedWithJavaUtilList_(self, phoneBook);
}

- (void)performImportWithJavaUtilArrayList:(JavaUtilArrayList *)phoneToImportsPart
                     withJavaUtilArrayList:(JavaUtilArrayList *)emailToImportsPart {
  ImActorModelModulesContactsBookImportActor_performImportWithJavaUtilArrayList_withJavaUtilArrayList_(self, phoneToImportsPart, emailToImportsPart);
}

- (jboolean)isImportedWithLong:(jlong)phone {
  return ImActorModelModulesContactsBookImportActor_isImportedWithLong_(self, phone);
}

- (jboolean)isImportedWithNSString:(NSString *)email {
  return ImActorModelModulesContactsBookImportActor_isImportedWithNSString_(self, email);
}

- (void)markImportedWithLong:(jlong)phone {
  ImActorModelModulesContactsBookImportActor_markImportedWithLong_(self, phone);
}

- (void)markImportedWithNSString:(NSString *)email {
  ImActorModelModulesContactsBookImportActor_markImportedWithNSString_(self, email);
}

- (void)markImported {
  ImActorModelModulesContactsBookImportActor_markImported(self);
}

- (void)onReceiveWithId:(id)message {
  if ([message isKindOfClass:[ImActorModelModulesContactsBookImportActor_PerformSync class]]) {
    ImActorModelModulesContactsBookImportActor_performSync(self);
  }
  else if ([message isKindOfClass:[ImActorModelModulesContactsBookImportActor_PhoneBookLoaded class]]) {
    ImActorModelModulesContactsBookImportActor_onPhoneBookLoadedWithJavaUtilList_(self, [((ImActorModelModulesContactsBookImportActor_PhoneBookLoaded *) nil_chk(((ImActorModelModulesContactsBookImportActor_PhoneBookLoaded *) check_class_cast(message, [ImActorModelModulesContactsBookImportActor_PhoneBookLoaded class])))) getPhoneBook]);
  }
  else {
    [self dropWithId:message];
  }
}

@end

void ImActorModelModulesContactsBookImportActor_initWithImActorModelModulesModules_(ImActorModelModulesContactsBookImportActor *self, ImActorModelModulesModules *messenger) {
  (void) ImActorModelModulesUtilsModuleActor_initWithImActorModelModulesModules_(self, messenger);
  self->importingPhones_ = new_JavaUtilHashSet_init();
  self->importingEmails_ = new_JavaUtilHashSet_init();
  self->isSyncInProgress_ = NO;
  self->ENABLE_LOG_ = [((AMConfiguration *) nil_chk([((ImActorModelModulesModules *) nil_chk(messenger)) getConfiguration])) isEnableContactsLogging];
}

ImActorModelModulesContactsBookImportActor *new_ImActorModelModulesContactsBookImportActor_initWithImActorModelModulesModules_(ImActorModelModulesModules *messenger) {
  ImActorModelModulesContactsBookImportActor *self = [ImActorModelModulesContactsBookImportActor alloc];
  ImActorModelModulesContactsBookImportActor_initWithImActorModelModulesModules_(self, messenger);
  return self;
}

void ImActorModelModulesContactsBookImportActor_performSync(ImActorModelModulesContactsBookImportActor *self) {
  if (self->ENABLE_LOG_) {
    AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_TAG_, @"Checking sync...");
  }
  if (self->isSyncInProgress_) {
    if (self->ENABLE_LOG_) {
      AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_TAG_, @"Sync already in progress");
    }
    return;
  }
  self->isSyncInProgress_ = YES;
  if (self->ENABLE_LOG_) {
    AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_TAG_, @"Starting book loading...");
  }
  [((id<AMPhoneBookProvider>) nil_chk([((AMConfiguration *) nil_chk([((ImActorModelModulesModules *) nil_chk([self modules])) getConfiguration])) getPhoneBookProvider])) loadPhoneBookWithCallback:new_ImActorModelModulesContactsBookImportActor_$1_initWithImActorModelModulesContactsBookImportActor_(self)];
}

void ImActorModelModulesContactsBookImportActor_onPhoneBookLoadedWithJavaUtilList_(ImActorModelModulesContactsBookImportActor *self, id<JavaUtilList> phoneBook) {
  self->isSyncInProgress_ = NO;
  if (self->ENABLE_LOG_) {
    AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_TAG_, @"Book load completed");
  }
  JavaUtilArrayList *phoneToImports = new_JavaUtilArrayList_init();
  JavaUtilArrayList *emailToImports = new_JavaUtilArrayList_init();
  for (AMPhoneBookContact * __strong record in nil_chk(phoneBook)) {
    for (AMPhoneBookPhone * __strong phone in nil_chk([((AMPhoneBookContact *) nil_chk(record)) getPhones])) {
      if (ImActorModelModulesContactsBookImportActor_isImportedWithLong_(self, [((AMPhoneBookPhone *) nil_chk(phone)) getNumber])) {
        continue;
      }
      if ([((JavaUtilHashSet *) nil_chk(self->importingPhones_)) containsWithId:JavaLangLong_valueOfWithLong_([phone getNumber])]) {
        continue;
      }
      [self->importingPhones_ addWithId:JavaLangLong_valueOfWithLong_([phone getNumber])];
      [phoneToImports addWithId:new_ImActorModelApiPhoneToImport_initWithLong_withNSString_([phone getNumber], [record getName])];
    }
    for (AMPhoneBookEmail * __strong email in nil_chk([record getEmails])) {
      if (ImActorModelModulesContactsBookImportActor_isImportedWithNSString_(self, [((NSString *) nil_chk([((AMPhoneBookEmail *) nil_chk(email)) getEmail])) lowercaseString])) {
        continue;
      }
      if ([((JavaUtilHashSet *) nil_chk(self->importingEmails_)) containsWithId:[((NSString *) nil_chk([email getEmail])) lowercaseString]]) {
        continue;
      }
      [self->importingEmails_ addWithId:[((NSString *) nil_chk([email getEmail])) lowercaseString]];
      [emailToImports addWithId:new_ImActorModelApiEmailToImport_initWithNSString_withNSString_([((NSString *) nil_chk([email getEmail])) lowercaseString], [record getName])];
    }
  }
  if ([phoneToImports size] == 0 && [emailToImports size] == 0) {
    if (self->ENABLE_LOG_) {
      AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_TAG_, @"No new contacts found");
    }
    ImActorModelModulesContactsBookImportActor_markImported(self);
    return;
  }
  else {
    if (self->ENABLE_LOG_) {
      AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_TAG_, JreStrcat("$I$", @"Founded new ", ([phoneToImports size] + [emailToImports size]), @" contact records"));
    }
  }
  JavaUtilArrayList *phoneToImportsPart = new_JavaUtilArrayList_init();
  JavaUtilArrayList *emailToImportsPart = new_JavaUtilArrayList_init();
  jint count = 0;
  for (ImActorModelApiPhoneToImport * __strong phoneToImport in phoneToImports) {
    [phoneToImportsPart addWithId:phoneToImport];
    count++;
    if (count >= ImActorModelModulesContactsBookImportActor_MAX_IMPORT_SIZE) {
      ImActorModelModulesContactsBookImportActor_performImportWithJavaUtilArrayList_withJavaUtilArrayList_(self, phoneToImportsPart, emailToImportsPart);
      [phoneToImportsPart clear];
      [emailToImportsPart clear];
      count = 0;
    }
  }
  for (ImActorModelApiEmailToImport * __strong emailToImport in emailToImports) {
    [emailToImportsPart addWithId:emailToImport];
    count++;
    if (count >= ImActorModelModulesContactsBookImportActor_MAX_IMPORT_SIZE) {
      ImActorModelModulesContactsBookImportActor_performImportWithJavaUtilArrayList_withJavaUtilArrayList_(self, phoneToImportsPart, emailToImportsPart);
      [phoneToImportsPart clear];
      [emailToImportsPart clear];
      count = 0;
    }
  }
  if (count > 0) {
    ImActorModelModulesContactsBookImportActor_performImportWithJavaUtilArrayList_withJavaUtilArrayList_(self, phoneToImportsPart, emailToImportsPart);
  }
}

void ImActorModelModulesContactsBookImportActor_performImportWithJavaUtilArrayList_withJavaUtilArrayList_(ImActorModelModulesContactsBookImportActor *self, JavaUtilArrayList *phoneToImportsPart, JavaUtilArrayList *emailToImportsPart) {
  if (self->ENABLE_LOG_) {
    AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_TAG_, JreStrcat("$I$I$", @"Performing import part with ", [((JavaUtilArrayList *) nil_chk(phoneToImportsPart)) size], @" phones and ", [((JavaUtilArrayList *) nil_chk(emailToImportsPart)) size], @" emails"));
  }
  IOSObjectArray *phones = [phoneToImportsPart toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:[((JavaUtilArrayList *) nil_chk(phoneToImportsPart)) size] type:ImActorModelApiPhoneToImport_class_()]];
  IOSObjectArray *emailToImports = [emailToImportsPart toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:[((JavaUtilArrayList *) nil_chk(emailToImportsPart)) size] type:ImActorModelApiEmailToImport_class_()]];
  [self requestWithImActorModelNetworkParserRequest:new_ImActorModelApiRpcRequestImportContacts_initWithJavaUtilList_withJavaUtilList_((id<JavaUtilList>) check_protocol_cast([phoneToImportsPart clone], @protocol(JavaUtilList)), (id<JavaUtilList>) check_protocol_cast([emailToImportsPart clone], @protocol(JavaUtilList))) withAMRpcCallback:new_ImActorModelModulesContactsBookImportActor_$2_initWithImActorModelModulesContactsBookImportActor_withImActorModelApiPhoneToImportArray_withImActorModelApiEmailToImportArray_(self, phones, emailToImports)];
}

jboolean ImActorModelModulesContactsBookImportActor_isImportedWithLong_(ImActorModelModulesContactsBookImportActor *self, jlong phone) {
  return [((id<DKPreferencesStorage>) nil_chk([self preferences])) getBoolWithKey:JreStrcat("$J", @"book_phone_", phone) withDefault:NO];
}

jboolean ImActorModelModulesContactsBookImportActor_isImportedWithNSString_(ImActorModelModulesContactsBookImportActor *self, NSString *email) {
  return [((id<DKPreferencesStorage>) nil_chk([self preferences])) getBoolWithKey:JreStrcat("$$", @"book_email_", [((NSString *) nil_chk(email)) lowercaseString]) withDefault:NO];
}

void ImActorModelModulesContactsBookImportActor_markImportedWithLong_(ImActorModelModulesContactsBookImportActor *self, jlong phone) {
  [((id<DKPreferencesStorage>) nil_chk([self preferences])) putBoolWithKey:JreStrcat("$J", @"book_phone_", phone) withValue:YES];
}

void ImActorModelModulesContactsBookImportActor_markImportedWithNSString_(ImActorModelModulesContactsBookImportActor *self, NSString *email) {
  [((id<DKPreferencesStorage>) nil_chk([self preferences])) putBoolWithKey:JreStrcat("$$", @"book_email_", [((NSString *) nil_chk(email)) lowercaseString]) withValue:YES];
}

void ImActorModelModulesContactsBookImportActor_markImported(ImActorModelModulesContactsBookImportActor *self) {
  [((ImActorModelModulesAppStateModule *) nil_chk([((ImActorModelModulesModules *) nil_chk([self modules])) getAppStateModule])) onBookImported];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesContactsBookImportActor)

@implementation ImActorModelModulesContactsBookImportActor_PerformSync

- (instancetype)init {
  ImActorModelModulesContactsBookImportActor_PerformSync_init(self);
  return self;
}

@end

void ImActorModelModulesContactsBookImportActor_PerformSync_init(ImActorModelModulesContactsBookImportActor_PerformSync *self) {
  (void) NSObject_init(self);
}

ImActorModelModulesContactsBookImportActor_PerformSync *new_ImActorModelModulesContactsBookImportActor_PerformSync_init() {
  ImActorModelModulesContactsBookImportActor_PerformSync *self = [ImActorModelModulesContactsBookImportActor_PerformSync alloc];
  ImActorModelModulesContactsBookImportActor_PerformSync_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesContactsBookImportActor_PerformSync)

@implementation ImActorModelModulesContactsBookImportActor_PhoneBookLoaded

- (instancetype)initWithJavaUtilList:(id<JavaUtilList>)phoneBook {
  ImActorModelModulesContactsBookImportActor_PhoneBookLoaded_initWithJavaUtilList_(self, phoneBook);
  return self;
}

- (id<JavaUtilList>)getPhoneBook {
  return phoneBook_;
}

@end

void ImActorModelModulesContactsBookImportActor_PhoneBookLoaded_initWithJavaUtilList_(ImActorModelModulesContactsBookImportActor_PhoneBookLoaded *self, id<JavaUtilList> phoneBook) {
  (void) NSObject_init(self);
  self->phoneBook_ = phoneBook;
}

ImActorModelModulesContactsBookImportActor_PhoneBookLoaded *new_ImActorModelModulesContactsBookImportActor_PhoneBookLoaded_initWithJavaUtilList_(id<JavaUtilList> phoneBook) {
  ImActorModelModulesContactsBookImportActor_PhoneBookLoaded *self = [ImActorModelModulesContactsBookImportActor_PhoneBookLoaded alloc];
  ImActorModelModulesContactsBookImportActor_PhoneBookLoaded_initWithJavaUtilList_(self, phoneBook);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesContactsBookImportActor_PhoneBookLoaded)

@implementation ImActorModelModulesContactsBookImportActor_$1

- (void)onLoadedWithContacts:(id<JavaUtilList>)contacts {
  [((DKActorRef *) nil_chk([this$0_ self__])) sendWithId:new_ImActorModelModulesContactsBookImportActor_PhoneBookLoaded_initWithJavaUtilList_(contacts)];
}

- (instancetype)initWithImActorModelModulesContactsBookImportActor:(ImActorModelModulesContactsBookImportActor *)outer$ {
  ImActorModelModulesContactsBookImportActor_$1_initWithImActorModelModulesContactsBookImportActor_(self, outer$);
  return self;
}

@end

void ImActorModelModulesContactsBookImportActor_$1_initWithImActorModelModulesContactsBookImportActor_(ImActorModelModulesContactsBookImportActor_$1 *self, ImActorModelModulesContactsBookImportActor *outer$) {
  self->this$0_ = outer$;
  (void) NSObject_init(self);
}

ImActorModelModulesContactsBookImportActor_$1 *new_ImActorModelModulesContactsBookImportActor_$1_initWithImActorModelModulesContactsBookImportActor_(ImActorModelModulesContactsBookImportActor *outer$) {
  ImActorModelModulesContactsBookImportActor_$1 *self = [ImActorModelModulesContactsBookImportActor_$1 alloc];
  ImActorModelModulesContactsBookImportActor_$1_initWithImActorModelModulesContactsBookImportActor_(self, outer$);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesContactsBookImportActor_$1)

@implementation ImActorModelModulesContactsBookImportActor_$2

- (void)onResult:(ImActorModelApiRpcResponseImportContacts *)response {
  {
    IOSObjectArray *a__ = val$phones_;
    ImActorModelApiPhoneToImport * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    ImActorModelApiPhoneToImport * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      ImActorModelApiPhoneToImport *phoneToImport = *b__++;
      ImActorModelModulesContactsBookImportActor_markImportedWithLong_(this$0_, [((ImActorModelApiPhoneToImport *) nil_chk(phoneToImport)) getPhoneNumber]);
      [((JavaUtilHashSet *) nil_chk(this$0_->importingPhones_)) removeWithId:JavaLangLong_valueOfWithLong_([phoneToImport getPhoneNumber])];
    }
  }
  {
    IOSObjectArray *a__ = val$emailToImports_;
    ImActorModelApiEmailToImport * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    ImActorModelApiEmailToImport * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      ImActorModelApiEmailToImport *emailToImport = *b__++;
      ImActorModelModulesContactsBookImportActor_markImportedWithNSString_(this$0_, [((ImActorModelApiEmailToImport *) nil_chk(emailToImport)) getEmail]);
      [((JavaUtilHashSet *) nil_chk(this$0_->importingEmails_)) removeWithId:[emailToImport getEmail]];
    }
  }
  if ([((JavaUtilHashSet *) nil_chk(this$0_->importingEmails_)) size] == 0 && [((JavaUtilHashSet *) nil_chk(this$0_->importingPhones_)) size] == 0) {
    ImActorModelModulesContactsBookImportActor_markImported(this$0_);
  }
  if ([((id<JavaUtilList>) nil_chk([((ImActorModelApiRpcResponseImportContacts *) nil_chk(response)) getUsers])) size] == 0) {
    if (this$0_->ENABLE_LOG_) {
      AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_get_TAG_(), @"Import success, but no new contacts found");
    }
    return;
  }
  if (this$0_->ENABLE_LOG_) {
    AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_get_TAG_(), JreStrcat("$I$", @"Import success with ", [((id<JavaUtilList>) nil_chk([response getUsers])) size], @" new contacts"));
  }
  JavaUtilArrayList *uids = new_JavaUtilArrayList_init();
  for (ImActorModelApiUser * __strong u in nil_chk([response getUsers])) {
    [uids addWithId:JavaLangInteger_valueOfWithInt_([((ImActorModelApiUser *) nil_chk(u)) getId])];
  }
  [((ImActorModelModulesUpdates *) nil_chk([this$0_ updates])) onUpdateReceivedWithId:new_ImActorModelApiBaseFatSeqUpdate_initWithInt_withByteArray_withInt_withByteArray_withJavaUtilList_withJavaUtilList_([response getSeq], [response getState], ImActorModelApiUpdatesUpdateContactsAdded_HEADER, [new_ImActorModelApiUpdatesUpdateContactsAdded_initWithJavaUtilList_(uids) toByteArray], [response getUsers], new_JavaUtilArrayList_init())];
}

- (void)onError:(AMRpcException *)e {
  if (this$0_->ENABLE_LOG_) {
    AMLog_dWithNSString_withNSString_(ImActorModelModulesContactsBookImportActor_get_TAG_(), @"Import failure");
  }
  [((AMRpcException *) nil_chk(e)) printStackTrace];
}

- (instancetype)initWithImActorModelModulesContactsBookImportActor:(ImActorModelModulesContactsBookImportActor *)outer$
                             withImActorModelApiPhoneToImportArray:(IOSObjectArray *)capture$0
                             withImActorModelApiEmailToImportArray:(IOSObjectArray *)capture$1 {
  ImActorModelModulesContactsBookImportActor_$2_initWithImActorModelModulesContactsBookImportActor_withImActorModelApiPhoneToImportArray_withImActorModelApiEmailToImportArray_(self, outer$, capture$0, capture$1);
  return self;
}

@end

void ImActorModelModulesContactsBookImportActor_$2_initWithImActorModelModulesContactsBookImportActor_withImActorModelApiPhoneToImportArray_withImActorModelApiEmailToImportArray_(ImActorModelModulesContactsBookImportActor_$2 *self, ImActorModelModulesContactsBookImportActor *outer$, IOSObjectArray *capture$0, IOSObjectArray *capture$1) {
  self->this$0_ = outer$;
  self->val$phones_ = capture$0;
  self->val$emailToImports_ = capture$1;
  (void) NSObject_init(self);
}

ImActorModelModulesContactsBookImportActor_$2 *new_ImActorModelModulesContactsBookImportActor_$2_initWithImActorModelModulesContactsBookImportActor_withImActorModelApiPhoneToImportArray_withImActorModelApiEmailToImportArray_(ImActorModelModulesContactsBookImportActor *outer$, IOSObjectArray *capture$0, IOSObjectArray *capture$1) {
  ImActorModelModulesContactsBookImportActor_$2 *self = [ImActorModelModulesContactsBookImportActor_$2 alloc];
  ImActorModelModulesContactsBookImportActor_$2_initWithImActorModelModulesContactsBookImportActor_withImActorModelApiPhoneToImportArray_withImActorModelApiEmailToImportArray_(self, outer$, capture$0, capture$1);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesContactsBookImportActor_$2)

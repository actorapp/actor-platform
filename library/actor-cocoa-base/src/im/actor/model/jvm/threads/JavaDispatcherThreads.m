//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-model/library/actor-cocoa-base/build/java/im/actor/model/jvm/threads/JavaDispatcherThreads.java
//


#line 1 "/Users/ex3ndr/Develop/actor-model/library/actor-cocoa-base/build/java/im/actor/model/jvm/threads/JavaDispatcherThreads.java"

#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "im/actor/model/droidkit/actors/ActorTime.h"
#include "im/actor/model/droidkit/actors/ThreadPriority.h"
#include "im/actor/model/droidkit/actors/dispatch/AbstractDispatchQueue.h"
#include "im/actor/model/droidkit/actors/dispatch/AbstractDispatcher.h"
#include "im/actor/model/droidkit/actors/dispatch/Dispatch.h"
#include "im/actor/model/droidkit/actors/dispatch/DispatchResult.h"
#include "im/actor/model/jvm/threads/JavaDispatcherThreads.h"
#include "java/lang/InterruptedException.h"
#include "java/lang/Thread.h"
#include "java/lang/Throwable.h"
#include "java/util/concurrent/atomic/AtomicInteger.h"

@interface ImActorModelJvmThreadsJavaDispatcherThreads () {
 @public
  IOSObjectArray *threads_;
  jint count_;
  DKThreadPriorityEnum *priority_;
  jboolean isClosed_;
  jint id__;
  NSString *name_;
}

@end

J2OBJC_FIELD_SETTER(ImActorModelJvmThreadsJavaDispatcherThreads, threads_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(ImActorModelJvmThreadsJavaDispatcherThreads, priority_, DKThreadPriorityEnum *)
J2OBJC_FIELD_SETTER(ImActorModelJvmThreadsJavaDispatcherThreads, name_, NSString *)

static JavaUtilConcurrentAtomicAtomicInteger *ImActorModelJvmThreadsJavaDispatcherThreads_INDEX_;
J2OBJC_STATIC_FIELD_GETTER(ImActorModelJvmThreadsJavaDispatcherThreads, INDEX_, JavaUtilConcurrentAtomicAtomicInteger *)

@interface ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread : JavaLangThread {
 @public
  ImActorModelJvmThreadsJavaDispatcherThreads *this$0_;
  jboolean isChanged__;
}

- (jboolean)isChanged;

- (void)setChangedWithBoolean:(jboolean)isChanged;

- (void)run;

- (instancetype)initWithImActorModelJvmThreadsJavaDispatcherThreads:(ImActorModelJvmThreadsJavaDispatcherThreads *)outer$;

@end

J2OBJC_EMPTY_STATIC_INIT(ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread)

J2OBJC_FIELD_SETTER(ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread, this$0_, ImActorModelJvmThreadsJavaDispatcherThreads *)

__attribute__((unused)) static void ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread_initWithImActorModelJvmThreadsJavaDispatcherThreads_(ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread *self, ImActorModelJvmThreadsJavaDispatcherThreads *outer$);

__attribute__((unused)) static ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread *new_ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread_initWithImActorModelJvmThreadsJavaDispatcherThreads_(ImActorModelJvmThreadsJavaDispatcherThreads *outer$) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread)

J2OBJC_INITIALIZED_DEFN(ImActorModelJvmThreadsJavaDispatcherThreads)


#line 19
@implementation ImActorModelJvmThreadsJavaDispatcherThreads


#line 43
- (instancetype)initWithNSString:(NSString *)name
                         withInt:(jint)count
        withDKThreadPriorityEnum:(DKThreadPriorityEnum *)priority
     withDKAbstractDispatchQueue:(DKAbstractDispatchQueue *)queue
                  withDKDispatch:(id<DKDispatch>)dispatch
                     withBoolean:(jboolean)createThreads {
  ImActorModelJvmThreadsJavaDispatcherThreads_initWithNSString_withInt_withDKThreadPriorityEnum_withDKAbstractDispatchQueue_withDKDispatch_withBoolean_(self, name, count, priority, queue, dispatch, createThreads);
  return self;
}


#line 56
- (void)startPool {
  if (self->threads_ != nil) {
    return;
  }
  self->threads_ = [IOSObjectArray newArrayWithLength:count_ type:JavaLangThread_class_()];
  for (jint i = 0; i < count_; i++) {
    (void) IOSObjectArray_Set(self->threads_, i, new_ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread_initWithImActorModelJvmThreadsJavaDispatcherThreads_(self));
    [((JavaLangThread *) nil_chk(IOSObjectArray_Get(self->threads_, i))) setNameWithNSString:JreStrcat("$$CI", @"Pool_", name_, '_', i)];
    switch ([priority_ ordinal]) {
      case DKThreadPriority_HIGH:
      [((JavaLangThread *) nil_chk(IOSObjectArray_Get(self->threads_, i))) setPriorityWithInt:JavaLangThread_MAX_PRIORITY];
      break;
      case DKThreadPriority_LOW:
      [((JavaLangThread *) nil_chk(IOSObjectArray_Get(self->threads_, i))) setPriorityWithInt:JavaLangThread_MIN_PRIORITY];
      break;
      default:
      case DKThreadPriority_NORMAL:
      [((JavaLangThread *) nil_chk(IOSObjectArray_Get(self->threads_, i))) setPriorityWithInt:JavaLangThread_NORM_PRIORITY];
      break;
    }
    [((JavaLangThread *) nil_chk(IOSObjectArray_Get(self->threads_, i))) start];
  }
}


#line 83
- (void)close {
  isClosed_ = YES;
  [self notifyDispatcher];
}


#line 92
- (void)notifyDispatcher {
  if (threads_ != nil) {
    @synchronized(threads_) {
      [threads_ notifyAll];
      {
        IOSObjectArray *a__ =
#line 96
        threads_;
        JavaLangThread * const *b__ = a__->buffer_;
        JavaLangThread * const *e__ = b__ + a__->size_;
        while (b__ < e__) {
          JavaLangThread *thread = *b__++;
          
#line 97
          [((ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread *) nil_chk(((ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread *) check_class_cast(thread, [ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread class])))) setChangedWithBoolean:YES];
        }
      }
    }
  }
}

+ (void)initialize {
  if (self == [ImActorModelJvmThreadsJavaDispatcherThreads class]) {
    ImActorModelJvmThreadsJavaDispatcherThreads_INDEX_ = new_JavaUtilConcurrentAtomicAtomicInteger_initWithInt_(
#line 21
    1);
    J2OBJC_SET_INITIALIZED(ImActorModelJvmThreadsJavaDispatcherThreads)
  }
}

@end


#line 43
void ImActorModelJvmThreadsJavaDispatcherThreads_initWithNSString_withInt_withDKThreadPriorityEnum_withDKAbstractDispatchQueue_withDKDispatch_withBoolean_(ImActorModelJvmThreadsJavaDispatcherThreads *self, NSString *name, jint count, DKThreadPriorityEnum *priority, DKAbstractDispatchQueue *queue, id<DKDispatch> dispatch, jboolean createThreads) {
  (void) DKAbstractDispatcher_initWithDKAbstractDispatchQueue_withDKDispatch_(self, queue, dispatch);
  self->isClosed_ =
#line 28
  NO;
  
#line 46
  self->id__ = [((JavaUtilConcurrentAtomicAtomicInteger *) nil_chk(ImActorModelJvmThreadsJavaDispatcherThreads_INDEX_)) getAndIncrement];
  self->name_ = name;
  self->count_ = count;
  self->priority_ = priority;
  
#line 51
  if (createThreads) {
    [self startPool];
  }
}


#line 43
ImActorModelJvmThreadsJavaDispatcherThreads *new_ImActorModelJvmThreadsJavaDispatcherThreads_initWithNSString_withInt_withDKThreadPriorityEnum_withDKAbstractDispatchQueue_withDKDispatch_withBoolean_(NSString *name, jint count, DKThreadPriorityEnum *priority, DKAbstractDispatchQueue *queue, id<DKDispatch> dispatch, jboolean createThreads) {
  ImActorModelJvmThreadsJavaDispatcherThreads *self = [ImActorModelJvmThreadsJavaDispatcherThreads alloc];
  ImActorModelJvmThreadsJavaDispatcherThreads_initWithNSString_withInt_withDKThreadPriorityEnum_withDKAbstractDispatchQueue_withDKDispatch_withBoolean_(self, name, count, priority, queue, dispatch, createThreads);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelJvmThreadsJavaDispatcherThreads)


#line 106
@implementation ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread


#line 110
- (jboolean)isChanged {
  return isChanged__;
}

- (void)setChangedWithBoolean:(jboolean)isChanged {
  self->isChanged__ = isChanged;
}


#line 119
- (void)run {
  while (!this$0_->isClosed_) {
    jlong time = DKActorTime_currentTime();
    
#line 123
    @synchronized(this$0_->threads_) {
      isChanged__ = NO;
    }
    
#line 127
    DKDispatchResult *action = [((DKAbstractDispatchQueue *) nil_chk([this$0_ getQueue])) dispatchWithLong:time];
    
#line 129
    if (![((DKDispatchResult *) nil_chk(action)) isResult]) {
      if (isChanged__) {
        continue;
      }
      
#line 134
      @synchronized(this$0_->threads_) {
        jlong delay = [action getDelay];
        [action recycle];
        
#line 138
        @try {
          if (delay > 0) {
            [((IOSObjectArray *) nil_chk(this$0_->threads_)) waitWithLong:delay];
          }
          continue;
        }
        @catch (
#line 143
        JavaLangInterruptedException *e) {
          [((JavaLangInterruptedException *) nil_chk(e)) printStackTrace];
          return;
        }
      }
    }
    
#line 150
    @try {
      id actiondData = (id) [action getRes];
      [action recycle];
      [this$0_ dispatchMessageWithId:actiondData];
    }
    @catch (
#line 154
    JavaLangThrowable *t) {
      
#line 158
      [((JavaLangThrowable *) nil_chk(t)) printStackTrace];
    }
  }
}

- (instancetype)initWithImActorModelJvmThreadsJavaDispatcherThreads:(ImActorModelJvmThreadsJavaDispatcherThreads *)outer$ {
  ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread_initWithImActorModelJvmThreadsJavaDispatcherThreads_(self, outer$);
  return self;
}

@end

void ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread_initWithImActorModelJvmThreadsJavaDispatcherThreads_(ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread *self, ImActorModelJvmThreadsJavaDispatcherThreads *outer$) {
  self->this$0_ = outer$;
  (void) JavaLangThread_init(self);
  self->isChanged__ =
#line 108
  NO;
}

ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread *new_ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread_initWithImActorModelJvmThreadsJavaDispatcherThreads_(ImActorModelJvmThreadsJavaDispatcherThreads *outer$) {
  ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread *self = [ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread alloc];
  ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread_initWithImActorModelJvmThreadsJavaDispatcherThreads_(self, outer$);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelJvmThreadsJavaDispatcherThreads_DispatcherThread)
